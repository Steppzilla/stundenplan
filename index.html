<Doctype! html>

<html>

<head>
<title> Stundenplan-App
</title>
<style>

table {
       width:100%;
      }
tr:nth-child(4),tr:nth-child(5),tr:nth-child(8),tr:nth-child(9){
background-color:aliceblue;
}

tr{
	}
      
td {
	height: auto;
	min-height:8mm;
	min-width:5mm;
    border:1px solid;
	border-radius:10px;
    vertical-align:top;
	text-align:center;
	margin:1pt;
	}

p{	
	margin:0pt;
}

.noclick{
pointer-events:none;
}

.plan{
	border-bottom:dotted;
	border-left: solid;
	border-width:1pt;
	}
	
.kuerzell:hover {
background-color:steelblue;

	
	}
	
	
@media print {
	@page {
	margin: 5pt; 
	font-family: "times new roman", times, serif;
    text-align: justify;}
	button{display:none;}
	td{	
	border-width:0 pt;
	margin:0pt;
	padding:0pt;
	}
  
}


</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
</head>


<body>


<button onClick="zerstoeren()">delete
</button>
<button onClick="drucken()">drucken
</button>
<input>
</input>
<button onClick="speichern()">Speicher-String erstellen
</button>
<button onClick="laden()">String aus Box laden
</button>

<div class="main">
<h2>Montag</h2>
<table>
</table>
<h2>Dienstag</h2>
<div class="tableCopy">
</div>
<h2>Mittwoch</h2>
<div class="tableCopy">
</div>
<h2>Donnerstag</h2>
<div class="tableCopy">
</div>
<h2>Freitag</h2>
<div class="tableCopy">
</div>
</div>

<script>
var stundenplanJSON=[];
var lehrer = [
"Ba",
"Cla",
"Cle",
"Co",
"Eh",
"Fr",
"Fun",
"Gre",
"Gü",
"Hä",
"He",
"Ke",
"Ki",
"Ne",
"Lo",
"Lb",
"PM",
"Pa",
"Rei",
"RoP",
"San",
"Sc",
"Sm",
"Sod",
"So",
"Ste",
"Stk",
"Wa",
"Wo",
"Ze",
"Zw"
];


for(i=0;i<11;i++){
$("table").append("<tr>" + "</tr>");

	for(j=0;j<15;j++){
		if(i==0){
		$("table").children().eq(i).append("<th class='noclick'>"+"</th>");
		}
		else if(j==0){ //Stundenzahlen
		$("table").children().eq(i).append("<th class='noclick'>"+ i +"</th>");
		}else{
		$("table").children().eq(i).append("<td>"+"</td>");
		}
	}
}
//Klassennummern
for(i=0;i<15;i++){
	if(i==0){
	$("th").eq(i).text("Std");
	}else{
	$("th").eq(i).text(i);
	}
}
//Lehrerkürzel
for(i=0;i<lehrer.length; i++){
$("table").children().eq(0).append("<th class='kuerzell'>"+lehrer[i]+"</th>");
	for(j=1;j<11;j++){
$("table").children().eq(j).append("<th class='noclick plan' >"+ "</th>");
}
}
//Kopie
$("table").clone().appendTo(".tableCopy");



var kuerzel="";
var spalteLehrer="";
var spalteKlasse="";
var reiheStunde="";
var inhalt=[];
var lehrerItem="";
var zerstoerung=false;


$("th").click(function(){
zerstoerung=false;
kuerzel=$(this).text();
lehrerItem="<p>"+kuerzel+"</p>";
spalteLehrer=$(this).index();
});


$("td").click(function(){
	inhalt=[];
	var laenge=$(this).children().length;
	for(j=0;j<laenge;j++){
		var jo=""+$(this).children().eq(j).text().trim();
		inhalt.push(jo);
	}
	//alert(inhalt);
	spalteKlasse=$(this).index();
	reiheStunde=$(this).parent().index();
	klasseVorher=$(this).parent().children().eq(spalteLehrer).text().trim();
	
	if(zerstoerung==false){
		if(klasseVorher==""){
		$(this).append(lehrerItem);
		$(this).parent().children().eq(spalteLehrer).append("<div>"+spalteKlasse+"</div>");
		}else{
		alert("lehrer " + kuerzel + " schon vergeben");
		}
	}else{//bei zerstörung aktiv:
		var kurz="";
		var lehrerIndex=[];
		for(i=0;i<lehrer.length;i++){
			kurz=lehrer[i];
	
			for(j=0;j<laenge;j++){
			
				if(kurz==inhalt[j]){
					var zahl=i+15;
					lehrerIndex.push(zahl);
				}
			}
		}
		for(j=0;j<laenge;j++){
		$(this).parent().children().eq(lehrerIndex[j]).empty();
		}
		$(this).empty();
	}

});


function zerstoeren(){
if(zerstoerung==false){zerstoerung=true;}
else{
zerstoerung=false;
}
}

function drucken(){
$("td").css("border-radius","5pt");
$("td").css("margin","0pt");
$("td").css("padding","0pt");
window.print();

}

var anzahlTD=$("td").length;

function speichern(){
$("input").val("");
stundenplanJSON=[];
for (i=0;i < anzahlTD ;i++){
	var tdKinder = $("td").eq(i).html();// welches Format? String?
	stundenplanJSON.push(tdKinder);
	$("input").val(JSON.stringify(stundenplanJSON));
}
//stundenplanJSON.stringify();
}

function laden(){ //aus box laden ist verschoben in aktuellerPlan() dafür müsste input wieder rein

$(".plan").empty();
$("td").empty();
var inputInhalt=$("input").val();
var string =inputInhalt.slice(1,inputInhalt.length-1);//Anführungszeichen wegschneiden
var array=string.split(",");
for (i=0;i<anzahlTD;i++){ 
	var arraylaenge=array[i].length;
	$("td").eq(i).append(array[i].slice(1,arraylaenge-1)); // hier fügt er in jedes td feld den Inhalt des Array zu
	// klassenzahlen hinzufügen bei den Lehrern (erst kürzel extrahieren):
}

for(i=0;i<anzahlTD;i++){
	var aktuelleBox=$("td").eq(i);
	var kinderanzahl=aktuelleBox.children().length;
	if(kinderanzahl==0){}
	else{
		for(j=0;j<kinderanzahl;j++){
		//	alert(i + "  " + j);
			var kue=aktuelleBox.children().eq(j).text();
			var lehrerspalt=lehrerSpalteErmitteln(kue);
			var klasse=aktuelleBox.index();
			//var zeile=aktuelleBox.parent().index();
			aktuelleBox.parent().children().eq(lehrerspalt).append("<div>"+klasse+"</div>");
			
		}
	}

}

}




aktuellerPlan();

function lehrerSpalteErmitteln(kuerz){
	//alert(kuerz);
	var zahli="";
	for(z=0;z<lehrer.length;z++){
				if(kuerz==lehrer[z]){
										zahli=z+15;
					}	
		}
		return zahli;
}

function aktuellerPlan(){
//ke einfügen
var plangesamtString='["<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Eh</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Eh</p>","","<p>Gü</p>","<p>Ki</p>","<p>Ze</p>","<p>Ke</p>","<p>So</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Wa</p><p>Zw</p>","<p>Fr</p><p>Ne</p>","","","","","<p>San</p>","","<p>Gü</p>","<p>Co</p>","<p>Wa</p>","<p>He</p><p>Zw</p>","<p>Ki</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Eh</p><p>Hä</p>","<p>Stk</p>","<p>Pa</p><p>Ne</p>","<p>So</p><p>Ze</p>","<p>PM</p><p>Ste</p>","<p>Fr</p>","<p>San</p>","","<p>Pa</p>","<p>Co</p><p>Ne</p>","<p>Ki</p>","<p>Sm</p>","<p>Gü</p><p>Zw</p>","","<p>Cle</p><p>Fun</p><p>RoP</p>","","<p>Eh</p><p>San</p>","<p>Ze</p><p>So</p>","<p>Fr</p><p>Hä</p>","<p>Wo</p><p>Ste</p>","<p>Lb</p>","<p>Cla</p>","","","<p>Pa</p><p>Hä</p>","","<p>Ze</p>","<p>Gü</p><p>Zw</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>So</p><p>Fr</p>","","","","","<p>Lb</p>","<p>Cla</p>","","","","","","<p>Ne</p><p>Ze</p>","","","","","","","","","","","","","","<p>Ze</p><p>Ne</p>","<p>Hä</p>","","","","","","<p>Sod</p>","<p>Gre</p>","","","","","","","","","<p>Co</p>","<p>Pa</p>","<p>San</p>","<p>Sc</p>","<p>Sod</p>","<p>Gre</p>","","","","","","","","","","","","","<p>Sod</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Eh</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Eh</p>","","<p>Ke</p>","<p>He</p><p>Zw</p>","<p>Ki</p>","<p>Sm</p>","<p>PM</p>","<p>San</p><p>Gü</p>","<p>Eh</p><p>Ze</p>","<p>Fr</p><p>So</p>","","","","","<p>Pa</p>","","<p>He</p><p>Zw</p>","<p>Co</p>","<p>Wa</p>","<p>Fr</p>","<p>PM</p>","<p>Gü</p><p>San</p>","<p>Ze</p><p>Eh</p>","<p>So</p><p>Sc</p>","<p>RoP</p><p>Lo</p>","<p>Sod</p>","<p>Ste</p><p>Ba</p>","<p>Ne</p>","<p>Pa</p>","","<p>Fr</p>","<p>San</p>","<p>Gü</p><p>Zw</p>","<p>Ke</p>","<p>So</p>","<p>Ze</p>","<p>PM</p>","","","","","","<p>Sod</p>","<p>Gre</p>","","","<p>Ze</p>","","<p>Ki</p>","<p>So</p><p>Ne</p>","<p>PM</p>","<p>He</p><p>Zw</p>","","","","","<p>Sod</p>","<p>Gre</p>","","","","","","","","<p>Cle</p><p>Fun</p><p>RoP</p>","","","","","","","","","","","","","","<p>Cle</p><p>Fun</p><p>RoP</p>","","","","","<p>Gre</p>","<p>Ste</p>","","","","","","","","","","","","","<p>Gre</p>","<p>Ste</p>","","","","","","","","","","","","","","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Cla</p><p>Lb</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Cla</p><p>Lb</p>","","<p>Fr</p>","<p>San</p>","<p>Ki</p>","<p>Ke</p>","<p>Ze</p>","<p>Ne</p><p>So</p>","<p>He</p>","<p>PM</p>","","","","","<p>Pa</p>","","<p>Ke</p>","<p>Wa</p>","<p>Ki</p>","<p>Sm</p>","<p>Stk</p>","<p>San</p>","<p>Eh</p><p>Ze</p>","<p>PM</p>","<p>He</p>","<p>Sc</p><p>So</p>","<p>Fr</p>","<p>Ste</p><p>Wo</p>","<p>Pa</p>","","<p>Ke</p>","<p>Ki</p>","<p>Hä</p><p>Pa</p>","<p>Lb</p>","<p>Ze</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","","<p>Ne</p>","<p>PM</p>","<p>So</p><p>Sc</p>","<p>Eh</p>","<p>Fr</p>","<p>Gre</p>","<p>Ste</p>","","","","<p>Lb</p>","","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Hä</p><p>Eh</p>","<p>Sc</p><p>So</p>","<p>PM</p>","<p>Wo</p><p>Sod</p>","","","<p>Gre</p>","<p>Ste</p>","","","","","","","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Ne</p>","","<p>Ze</p>","<p>Lb</p><p>Lo</p><p>Cla</p>","","","","","","","","","<p>PM</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","","<p>San</p><p>Eh</p>","<p>Ze</p>","","","<p>Sod</p>","<p>Gre</p>","","","","","","<p>PM</p>","","","","","","","<p>Sod</p>","<p>Gre</p>","","","","","","","","","","","","","<p>Gre</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Eh</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Eh</p>","","<p>Pa</p>","<p>San</p>","<p>PM</p>","<p>Sm</p>","<p>Gü</p>","<p>Wa</p>","<p>Eh</p><p>Ze</p>","<p>So</p><p>Fr</p>","","","","","<p>Lb</p>","<p>Cla</p>","<p>Fr</p>","<p>Ki</p>","<p>PM</p>","<p>Sm</p>","<p>Gü</p>","<p>So</p>","<p>He</p>","<p>Sc</p><p>Stk</p>","<p>Ne</p><p>Pa</p>","<p>Ze</p>","<p>Ba</p><p>Ste</p>","<p>Eh</p>","<p>Lb</p>","<p>Cla</p>","<p>Wa</p>","<p>Ne</p><p>Co</p>","<p>Ki</p>","<p>Fr</p>","<p>So</p>","<p>Pa</p><p>San</p>","<p>Sc</p><p>Stk</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Ba</p>","<p>PM</p>","","<p>Eh</p>","<p>Gre</p>","<p>Ste</p>","","","","","<p>Ze</p>","","","<p>Cle</p><p>Fun</p><p>RoP</p>","","<p>PM</p>","<p>Fr</p>","","<p>Gre</p>","<p>Ste</p>","","","","","","","","","<p>San</p>","","<p>PM</p>","<p>Fr</p>","","","","","","","","","","","","","<p>PM</p>","<p>Fr</p><p>Ne</p>","","","","","","","","","","","","","","<p>He</p>","","","","","","","","","","","","","","","","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Gre</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>Sm</p>","<p>Ki</p>","<p>Gü</p>","<p>He</p>","<p>Stk</p>","","","","","<p>Gre</p>","","<p>Ke</p>","<p>Ki</p>","<p>Ze</p>","<p>Fr</p>","<p>Wa</p>","<p>So</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Stk</p>","","","","","<p>San</p>","","<p>Ke</p>","<p>Ki</p>","<p>Pa</p>","<p>PM</p>","<p>Stk</p>","<p>Ze</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Ne</p><p>Fr</p>","<p>Lo</p><p>Ba</p>","<p>So</p><p>Hä</p>","","<p>Sc</p>","<p>San</p>","","<p>Ke</p>","<p>Co</p>","<p>Wa</p>","<p>PM</p>","<p>Stk</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Sc</p><p>Ze</p>","","<p>San</p><p>Eh</p>","<p>Hä</p><p>So</p>","<p>Pa</p>","<p>Fr</p>","<p>Cla</p>","<p>Lb</p>","","","","","","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Ze</p><p>Sc</p>","<p>Fr</p><p>So</p>","","","","<p>Eh</p>","<p>Cla</p>","<p>Lb</p>","","","","","","","","<p>Cle</p><p>Fun</p><p>RoP</p>","<p>Eh</p><p>San</p>","<p>Sod</p><p>Wo</p>","<p>Hä</p><p>Fr</p>","","","","","","","","","","<p>Hä</p>","<p>Cle</p><p>Fun</p><p>RoP</p>","","<p>He</p>","<p>Eh</p>","<p>PM</p>","","<p>Sod</p>","","","","","","","","","","","<p>Eh</p>","<p>PM</p>","","<p>Sod</p>","","","","","","","","","","","","","",""]';$("input").val(plangesamtString);laden();
}




</script>
</body>


</html>